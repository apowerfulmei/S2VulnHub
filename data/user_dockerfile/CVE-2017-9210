FROM ubuntu:16.04
RUN sed -i "s@http://.*archive.ubuntu.com@http://mirrors.ustc.edu.cn/@g" /etc/apt/sources.list
RUN sed -i "s@http://.*security.ubuntu.com@http://mirrors.ustc.edu.cn/@g" /etc/apt/sources.list
ARG DEBIAN_FRONTEND=noninteractive
RUN apt update && apt install -y iputils-ping wget git vim build-essential cmake unzip
RUN apt install -y automake autoconf libtool libpcre3-dev pkg-config zlib1g-dev libjpeg-dev libssl-dev
WORKDIR /root
RUN git clone https://github.com/qpdf/qpdf
WORKDIR /root/qpdf
RUN git checkout b7302a9b727d28d59bff0f0f7d8d62ff6486aef6
RUN echo -n Li9hdXRvZ2VuLnNoCkNGTEFHUz0nLXN0ZD1jOTkgLWZzYW5pdGl6ZT1hZGRyZXNzJyBMREZMQUdTPSctZnNhbml0aXplPWFkZHJlc3MgLXN0YXRpYy1saWJhc2FuJyAuL2NvbmZpZ3VyZQpzZWQgLWkgJ3MvQlVJTERfSVRFTVMgOj0gbWFudWFsIGxpYnFwZGYgemxpYi1mbGF0ZSBsaWJ0ZXN0cyBxcGRmIGV4YW1wbGVzL0JVSUxEX0lURU1TIDo9IG1hbnVhbCBsaWJxcGRmIHpsaWItZmxhdGUgcXBkZiBleGFtcGxlcy8nIE1ha2VmaWxlCm1ha2UgLWo= | base64 -d > build.sh
RUN wget https://github.com/asarubbo/poc/raw/master/00177-qpdf-infiniteloop3
RUN echo -n Li9xcGRmL2J1aWxkL3FwZGYgMDAxNzctcXBkZi1pbmZpbml0ZWxvb3AzIC0= | base64 -d > trigger.sh
RUN bash build.sh || true
CMD ["/bin/bash"]
