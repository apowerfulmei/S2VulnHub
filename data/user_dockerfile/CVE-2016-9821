FROM ubuntu:16.04
RUN sed -i "s@http://.*archive.ubuntu.com@http://mirrors.ustc.edu.cn/@g" /etc/apt/sources.list
RUN sed -i "s@http://.*security.ubuntu.com@http://mirrors.ustc.edu.cn/@g" /etc/apt/sources.list
ARG DEBIAN_FRONTEND=noninteractive
RUN apt update && apt install -y iputils-ping wget git vim build-essential cmake unzip
RUN apt install -y nasm pkg-config libtool automake autoconf
WORKDIR /root
RUN git clone https://github.com/libav/libav
WORKDIR /root/libav
RUN git checkout 3c3a0a06804e901cb9d6d94784a4ec8ecb8fe9e2
RUN echo -n Q0ZMQUdTPSctc3RkPWM5OSAtZnNhbml0aXplPWFkZHJlc3MnIENYWEZMQUdTPSctZnNhbml0aXplPWFkZHJlc3MnIC4vY29uZmlndXJlCm1ha2UgLWo= | base64 -d > build.sh
RUN wget https://github.com/mudongliang/LinuxFlaw/raw/master/CVE-2016-9821/00037-libav-signedintoverflow-mpegvideo_parser
RUN echo -n Li9hdnByb2JlIC4vMDAwMzctbGliYXYtc2lnbmVkaW50b3ZlcmZsb3ctbXBlZ3ZpZGVvX3BhcnNlcg== | base64 -d > trigger.sh
RUN bash build.sh || true
CMD ["/bin/bash"]
