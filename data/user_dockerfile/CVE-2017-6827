FROM ubuntu:16.04
RUN sed -i "s@http://.*archive.ubuntu.com@http://mirrors.ustc.edu.cn/@g" /etc/apt/sources.list
RUN sed -i "s@http://.*security.ubuntu.com@http://mirrors.ustc.edu.cn/@g" /etc/apt/sources.list
ARG DEBIAN_FRONTEND=noninteractive
RUN apt update && apt install -y iputils-ping wget git vim build-essential cmake unzip
RUN apt install -y pkg-config autoconf automake libtool-bin libtool libasound2-dev asciidoc
WORKDIR /root
RUN git clone https://github.com/mpruett/audiofile
WORKDIR /root/audiofile
RUN git checkout d19a5ace5ae891c778cbc710d78634de6084b846
RUN echo -n Q0ZMQUdTPSctc3RkPWM5OSAtZnNhbml0aXplPWFkZHJlc3MnIC4vYXV0b2dlbi5zaApzZWQgLWkgJ3MvU1VCRElSUyA9IGd0ZXN0IGxpYmF1ZGlvZmlsZSBzZmNvbW1hbmRzIHRlc3QgZXhhbXBsZXMgZG9jcy9TVUJESVJTID0gZ3Rlc3QgbGliYXVkaW9maWxlIHNmY29tbWFuZHMgdGVzdCBleGFtcGxlcy8nIE1ha2VmaWxlCm1ha2UgLWo= | base64 -d > build.sh
RUN wget https://github.com/asarubbo/poc/raw/master/00136-audiofile-heapoverflow-MSADPCM-initializeCoefficients
RUN echo -n Li9zZmNvbW1hbmRzL3NmaW5mbyAwMDEzNi1hdWRpb2ZpbGUtaGVhcG92ZXJmbG93LU1TQURQQ00taW5pdGlhbGl6ZUNvZWZmaWNpZW50cw== | base64 -d > trigger.sh
RUN bash build.sh || true
CMD ["/bin/bash"]
