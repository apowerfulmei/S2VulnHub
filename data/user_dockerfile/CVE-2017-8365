FROM ubuntu:16.04
RUN sed -i "s@http://.*archive.ubuntu.com@http://mirrors.ustc.edu.cn/@g" /etc/apt/sources.list
RUN sed -i "s@http://.*security.ubuntu.com@http://mirrors.ustc.edu.cn/@g" /etc/apt/sources.list
ARG DEBIAN_FRONTEND=noninteractive
RUN apt update && apt install -y iputils-ping wget git vim build-essential cmake unzip
RUN apt install -y autoconf autogen automake libasound2-dev libflac-dev libogg-dev libtool libvorbis-dev libopus-dev libmp3lame-dev libmpg123-dev pkg-config python
WORKDIR /root
RUN git clone https://github.com/libsndfile/libsndfile
WORKDIR /root/libsndfile
RUN git checkout 1d928bffdb65e827c3e7d17ece0e123b4a70ec6c
RUN echo -n YXV0b3JlY29uZiAtdmlmCkNGTEFHUz0nLXN0ZD1jOTkgLWZzYW5pdGl6ZT1hZGRyZXNzJyBMREZMQUdTPSctbGFzYW4nIC4vY29uZmlndXJlIC0tZW5hYmxlLXdlcnJvcgptYWtlCm1ha2UgY2hlY2s= | base64 -d > build.sh
RUN wget https://github.com/asarubbo/poc/raw/master/00263-libsndfile-globaloverflow-i2les_array
RUN echo -n Li9wcm9ncmFtcy9zbmRmaWxlLWNvbnZlcnQgMDAyNjMtbGlic25kZmlsZS1nbG9iYWxvdmVyZmxvdy1pMmxlc19hcnJheSBvdXQud2F2 | base64 -d > trigger.sh
RUN bash build.sh || true
CMD ["/bin/bash"]
