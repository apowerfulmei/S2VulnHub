FROM ubuntu:16.04
RUN sed -i "s@http://.*archive.ubuntu.com@http://mirrors.ustc.edu.cn/@g" /etc/apt/sources.list
RUN sed -i "s@http://.*security.ubuntu.com@http://mirrors.ustc.edu.cn/@g" /etc/apt/sources.list
ARG DEBIAN_FRONTEND=noninteractive
RUN apt update && apt install -y iputils-ping wget git vim build-essential cmake unzip
RUN apt install -y autoconf pkg-config libpng-dev pstoedit libpstoedit-dev libfreetype6-dev
WORKDIR /root
RUN git clone https://github.com/gdraheim/zziplib
WORKDIR /root/zziplib
RUN git checkout 0283ed8eeb494d7fc30d019b53e49490b3e8a6d7
RUN echo -n Q0ZMQUdTPSctZnNhbml0aXplPWFkZHJlc3MnIC4vY29uZmlndXJlCm1ha2UgLWo= | base64 -d > build.sh
RUN wget https://github.com/asarubbo/poc/raw/master/00154-zziplib-nullptr-zzip_mem_entry_new
RUN echo -n JChmaW5kIC4gLW5hbWUgJ3VuenppcGNhdC1tZW0nIHwgZ3JlcCBiaW5zL3VuKSAwMDE1NC16emlwbGliLW51bGxwdHItenppcF9tZW1fZW50cnlfbmV3 | base64 -d > trigger.sh
RUN bash build.sh || true
CMD ["/bin/bash"]
