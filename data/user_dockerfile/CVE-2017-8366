FROM ubuntu:16.04
RUN sed -i "s@http://.*archive.ubuntu.com@http://mirrors.ustc.edu.cn/@g" /etc/apt/sources.list
RUN sed -i "s@http://.*security.ubuntu.com@http://mirrors.ustc.edu.cn/@g" /etc/apt/sources.list
ARG DEBIAN_FRONTEND=noninteractive
RUN apt update && apt install -y iputils-ping wget git vim build-essential cmake unzip
RUN apt install -y debhelper bison check cmake flex groff libbsd-dev libcurl4-openssl-dev libmaxminddb-dev libgtk2.0-dev libgtk-3-dev libltdl-dev libluajit-5.1-dev libncurses5-dev libnet1-dev libpcap-dev libpcre2-dev libssl-dev
WORKDIR /root
RUN git clone https://github.com/Ettercap/ettercap
WORKDIR /root/ettercap
RUN git checkout 09dfbe5e1ae5e4c2868b3aaa942c197845c51843
RUN echo -n bWtkaXIgYnVpbGQgJiYgY2QgYnVpbGQKY21ha2UgLi4KbWFrZSBpbnN0YWxs | base64 -d > build.sh
RUN wget https://github.com/asarubbo/poc/raw/master/00224-ettercap-heapoverflow-strescape
RUN echo -n ZXR0ZXJmaWx0ZXIgMDAyMjQtZXR0ZXJjYXAtaGVhcG92ZXJmbG93LXN0cmVzY2FwZQ== | base64 -d > trigger.sh
RUN bash build.sh || true
CMD ["/bin/bash"]
