FROM ubuntu:16.04
RUN sed -i "s@http://.*archive.ubuntu.com@http://mirrors.ustc.edu.cn/@g" /etc/apt/sources.list
RUN sed -i "s@http://.*security.ubuntu.com@http://mirrors.ustc.edu.cn/@g" /etc/apt/sources.list
ARG DEBIAN_FRONTEND=noninteractive
RUN apt update && apt install -y iputils-ping wget git vim build-essential cmake unzip
RUN apt install -y autoconf libtool automake zlib1g libbz2-1.0 liblzma5 libzstd1 libssl-dev
WORKDIR /root
RUN git clone https://github.com/libarchive/libarchive
WORKDIR /root/libarchive
RUN git checkout 629358182b04d7de2316bbd29708c58ddf797fd2
RUN echo -n Li9idWlsZC9hdXRvZ2VuLnNoCkNGTEFHUz0nLXN0ZD1jOTkgLWZzYW5pdGl6ZT1hZGRyZXNzJyAuL2NvbmZpZ3VyZQptYWtlIC1qCm1ha2UgY2hlY2s= | base64 -d > build.sh
RUN wget https://github.com/asarubbo/poc/raw/master/00105-libarchive-heapoverflow-archive_le32dec
RUN echo -n YnNkdGFyIC10IC1mIDAwMTA1LWxpYmFyY2hpdmUtaGVhcG92ZXJmbG93LWFyY2hpdmVfbGUzMmRlYw== | base64 -d > trigger.sh
RUN bash build.sh || true
CMD ["/bin/bash"]
